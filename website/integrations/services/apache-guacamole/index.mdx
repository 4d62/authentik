---
title: Integrate with Apache Guacamole™
sidebar_label: Apache Guacamole™
---

# Integrate with Apache Guacamole™

<span class="badge badge--primary">Support level: authentik</span>

## What is Apache Guacamole™

> Apache Guacamole is a clientless remote desktop gateway. It supports standard protocols like VNC, RDP, and SSH.
>
> -- https://guacamole.apache.org/

## Preparation

The following placeholders are used in this guide:

- `guacamole.company` is the FQDN of the Guacamole installation.
- `authentik.company` is the FQDN of the authentik installation.

:::note
This documentation only lists the settings that have been changed from their default values. Please verify your changes carefully to avoid any issues accessing your application.
:::

## authentik configuration
>>>>>>> a4d4c09f6 (included w/ https://github.com/goauthentik/authentik/pull/12777 now)

1. From the **authentik Admin interface**, navigate to **Applications** -> **Applications**.
2. Use the [wizard](https://docs.goauthentik.io/docs/add-secure-apps/applications/manage_apps#add-new-applications) to create a new application and a **OAuth2/OpenID provider**. During this process:
    - Note the **Client ID**, **Client Secret**, and **slug** values because they will be required later.
    - Set a `Strict` redirect URI to <kbd>https://<em>guacamole.company</em>/</kbd>. If you have configured [Apache Tomcat](https://tomcat.apache.org/) to run Apache Guacamole in a subfolder, you will need to update this value accordingly.
    - Select any available signing key.

## Apache Guacamole Configuration

It is recommended to create an admin account in Guacamole before configuring Single Sign-On to simplify the process. Create a user in Guacamole using the same username as in authentik and grant them admin permissions. This step is important to avoid losing access to the Guacamole admin settings, as you may need to revert your changes without it.

:::warning
You can configure Apache Guacamole to use either the `sub` or `preferred_username` as the UID field under `user-name-attribute`. When using `preferred_username` as the user identifier, ensure that the [**Allow users to change username** setting](https://docs.goauthentik.io/docs/sys-mgmt/settings#allow-users-to-change-username) is disabled to prevent authentication issues. The `sub` option uses a unique, stable identifier for the user, while `preferred_username` uses the username configured in authentik.
:::

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs
  defaultValue="docker"
  values={[
    { label: 'Docker', value: 'docker' },
    { label: 'Standalone', value: 'standalone' },
  ]}>
  <TabItem value="docker">
    Docker containers are often configured through environment variables. The following variables are required:

<kbd data-language="yaml">
  OPENID_AUTHORIZATION_ENDPOINT=https://<em>authentik.company</em>/application/o/authorize/

OPENID_CLIENT_ID=<em>Client ID from authentik</em>

OPENID_ISSUER=https://<em>authentik.company</em>/application/o/<em>your-slug</em>/

OPENID_JWKS_ENDPOINT=https://<em>authentik.company</em>/application/o/<em>your-slug</em>/jwks/

OPENID_REDIRECT_URI=https://<em>guacamole.company</em>/ # This must match the Redirect URI set in authentik (including trailing slash).

OPENID_USERNAME_CLAIM_TYPE=preferred_username

</kbd>

  </TabItem>
  <TabItem value="standalone">
    To set up Apache Guacamole in a standalone environment, you'll need to adjust the settings in the `guacamole.properties` file, usually found in the `/etc/guacamole/` directory. Add the following settings:

<kbd>
    openid-authorization-endpoint=https://<em>authentik.company</em>/application/o/authorize/ openid-client-id=<em>Client ID from authentik</em>

    openid-issuer=https://<em>authentik.company</em>/application/o/<em>your-slug</em>/

    openid-jwks-endpoint=https://<em>authentik.company</em>/application/o/<em>your-slug</em>/jwks/

    openid-redirect-uri=https://<em>guacamole.company</em>/ # This must match the Redirect URI set in authentik (Including trailing slash).

    openid-username-claim-type=preferred_username

</kbd>

  </TabItem>
</Tabs>

## Configuration verification

To confirm that authentik is properly configured with Apache Guacamole, log out and log back in via authentik. A new button should have appeared on the bottom left of the login page.
